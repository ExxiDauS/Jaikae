{% extends 'base.html' %}

{% block title %}
  Jaikae - Pets Explore
{% endblock %}

{% block content %}
  <div class="container mx-auto px-4 py-8">
    <!-- Page Title -->
    <div class="text-center mb-8">
      <h1 class="text-4xl font-bold text-primary mb-2">Find Your Perfect Companion</h1>
      <p class="text-lg text-base-content/70">Discover amazing pets looking for their forever homes</p>
    </div>

    <div class="flex flex-col lg:flex-row gap-6">
      <!-- Filter Sidebar -->
      <div class="lg:w-1/4">
        <div class="card bg-base-200 shadow-md">
          <div class="card-body">
            <h2 class="card-title text-primary">Filters</h2>

            <form method="get" class="flex flex-col gap-2">
              {% csrf_token %}
              <div>{{ form.name.label_tag }}
                {{ form.name }}</div>

              <div>{{ form.sort_by.label_tag }}
                {{ form.sort_by }}</div>

              <div>{{ form.species.label_tag }}
                {{ form.species }}</div>

              <div>{{ form.breed.label_tag }}
                {{ form.breed }}</div>

              <div>
                <label class="label"><span class="label-text font-medium">Gender</span></label>
                <div class="flex flex-row gap-6">
                  <!-- Any -->
                  {% if not form.data.gender or form.data.gender == '' %}
                    <label class="flex items-center gap-2 cursor-pointer">
                      <input type="radio" name="gender" value="" class="radio radio-primary radio-sm" checked />
                      <span class="label-text">Any</span>
                    </label>
                  {% else %}
                    <label class="flex items-center gap-2 cursor-pointer">
                      <input type="radio" name="gender" value="" class="radio radio-primary radio-sm" />
                      <span class="label-text">Any</span>
                    </label>
                  {% endif %}

                  <!-- Male -->
                  {% if form.data.gender == 'Male' %}
                    <label class="flex items-center gap-2 cursor-pointer">
                      <input type="radio" name="gender" value="Male" class="radio radio-primary radio-sm" checked />
                      <span class="label-text">Male</span>
                    </label>
                  {% else %}
                    <label class="flex items-center gap-2 cursor-pointer">
                      <input type="radio" name="gender" value="Male" class="radio radio-primary radio-sm" />
                      <span class="label-text">Male</span>
                    </label>
                  {% endif %}

                  <!-- Female -->
                  {% if form.data.gender == 'Female' %}
                    <label class="flex items-center gap-2 cursor-pointer">
                      <input type="radio" name="gender" value="Female" class="radio radio-primary radio-sm" checked />
                      <span class="label-text">Female</span>
                    </label>
                  {% else %}
                    <label class="flex items-center gap-2 cursor-pointer">
                      <input type="radio" name="gender" value="Female" class="radio radio-primary radio-sm" />
                      <span class="label-text">Female</span>
                    </label>
                  {% endif %}
                </div>
              </div>

              <div>
                <label class="label"><span class="label-text font-medium">Age Range (Years)</span></label>
                <div class="grid grid-cols-2 gap-2">{{ form.min_age }} {{ form.max_age }}</div>
              </div>

              <div>
                <label class="label"><span class="label-text font-medium">Weight (kg)</span></label>
                <div class="grid grid-cols-2 gap-2">{{ form.min_weight }} {{ form.max_weight }}</div>
              </div>

              <div>
                <label class="label"><span class="label-text font-medium">Adoption Fee ($)</span></label>
                <div class="grid grid-cols-2 gap-2">{{ form.min_fee }} {{ form.max_fee }}</div>
              </div>

              <div>
                {{ form.vaccinated.label_tag }}
                <div class="mt-2 flex gap-2 items-center">
                  {{ form.vaccinated }}
                  <span class="label-text">Vaccinated</span>
                </div>
              </div>

              <div class="flex gap-2 mt-2">
                <button type="submit" class="btn btn-primary btn-sm flex-1 text-white">Apply Filters</button>
                <a href="{% url 'pets' %}" class="btn btn-outline btn-sm">Clear</a>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Pet Cards Grid -->
      <div class="lg:w-3/4">
        <!-- Results Info -->
        <div class="flex justify-between items-center mb-6">
          <div class="text-base-content/70">
            <span class="font-medium">{{ pets.count }}</span> pets found.
          </div>
        </div>

        <!-- Pet Cards Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
          {% for pet in pets %}
            <!-- Pet Card -->
            <div class="card card-compact bg-base-100 shadow-md hover:shadow-lg transition-shadow">
              <figure class="relative">
                <img src="https://images.unsplash.com/photo-1583337130417-3346a1be7dee?w=400&h=300&fit=crop" alt="Buddy" class="h-48 w-full object-cover" />
                {% if pet.status == 'Available' %}
                  <div class="badge badge-success absolute bottom-2 left-2">{{ pet.status }}</div>
                {% elif pet.status == 'Pending' %}
                  <div class="badge badge-warning absolute bottom-2 left-2">{{ pet.status }}</div>
                {% elif pet.status == 'Adopted' %}
                  <div class="badge badge-error absolute bottom-2 left-2">{{ pet.status }}</div>
                {% else %}
                  <div class="badge badge-neutral absolute bottom-2 left-2">{{ pet.status }}</div>
                {% endif %}
              </figure>
              <div class="card-body">
                <h2 class="card-title text-primary">{{ pet.name }}<div class="badge badge-secondary">{{ pet.age.0 }} years {{ pet.age.1 }} months</div></h2>
                <div class="text-sm space-y-1">
                  <div>
                    {{ pet.species }}{% if pet.breed %}
                      , {{ pet.breed }}
                    {% endif %}
                  </div>
                  <div>{{ pet.gender }}</div>
                  <div>{{ pet.color }}</div>
                  <div>{{ pet.weight }} kg</div>
                </div>
                <p class="text-sm text-base-content/70 mt-2">
                  {% if pet.description %}
                    {{ pet.description }}
                  {% else %}
                    No description available
                  {% endif %}
                </p>
                <div class="card-actions justify-between items-center mt-4">
                  <div class="text-lg font-bold text-primary">${{ pet.adoption_fee }}</div>
                  <a href="{% url 'pet_detail' pet.id %}" class="btn btn-primary btn-sm text-white">Learn More</a>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>

        <!-- Pagination -->
        <div class="flex justify-center mt-8">
          <div class="join">
            <button class="join-item btn btn-disabled">«</button>
            <button class="join-item btn btn-active">1</button>
            <button class="join-item btn">2</button>
            <button class="join-item btn">3</button>
            <button class="join-item btn">»</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer footer-center p-10 bg-primary text-primary-content mt-16">
    <div>
      <i class="fas fa-paw text-4xl"></i>
      <p class="font-bold">
        PetAdopt
        <br />Connecting pets with loving families since 2023
      </p>
      <p>Copyright © 2024 - All right reserved</p>
    </div>
  </footer>

  <script>
    const preselectedSpecies = "{{ request.GET.species|default:'' }}"
    const preselectedBreed = "{{ request.GET.breed|default:'' }}"
    
    async function toggleBreedSelect() {
      const speciesSelect = document.getElementById('species')
      const breedSelect = document.getElementById('breed')
    
      const species = speciesSelect.value
    
      // reset breed dropdown
      breedSelect.innerHTML = `<option value="">All Breeds</option>`
    
      if (!species) {
        breedSelect.disabled = true
        return
      }
    
      breedSelect.disabled = false
    
      // fetch and populate breed options for selected species
      try {
        const response = await fetch(`/pets/get-breeds/?species=${species}`)
        const data = await response.json()
    
        data.breeds.forEach((breed) => {
          const option = document.createElement('option')
          option.value = breed
          option.textContent = breed
    
          // reselect if matches filter
          if (breed === preselectedBreed) {
            option.selected = true
          }
          breedSelect.appendChild(option)
        })
      } catch (error) {
        console.error('Error loading breeds:', error)
      }
    }
    
    // initialize if a species is already selected
    window.addEventListener('DOMContentLoaded', () => {
      const speciesSelect = document.getElementById('species')
      const breedSelect = document.getElementById('breed')
    
      if (!speciesSelect.value) {
        breedSelect.disabled = true
      } else {
        toggleBreedSelect()
      }
    })
  </script>
{% endblock %}
