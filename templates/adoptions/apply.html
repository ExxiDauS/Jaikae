{% extends 'base.html' %}
{% load widget_tweaks %}

{% block title %}Apply for Adoption{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-2xl">
  <div class="card bg-base-100 shadow-xl">
    <div class="card-body">
      <h2 class="card-title text-3xl mb-6">
        {% if pet %}
          Apply to Adopt {{ pet.name }}
        {% else %}
          Apply for Adoption
        {% endif %}
      </h2>

      {% if pet %}
      <div class="alert alert-info mb-6">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <div>
          <p class="font-semibold">{{ pet.name }}</p>
          <p class="text-sm">{{ pet.species }} - {{ pet.breed }}</p>
        </div>
      </div>
      {% endif %}

      <form method="post" class="space-y-6">
        {% csrf_token %}

        <div class="form-control">
          <label class="label">
            <span class="label-text font-semibold">Select Pet</span>
          </label>
          <div class="dropdown dropdown-bottom w-full">
            <div tabindex="0" role="button" class="btn btn-outline w-full justify-between">
              <span id="selected-pet-text">
                {% if form.pet.value %}
                  {% for choice in form.pet.field.choices %}
                    {% if choice.0 == form.pet.value %}
                      {{ choice.1 }}
                    {% endif %}
                  {% endfor %}
                {% else %}
                  Choose a pet...
                {% endif %}
              </span>
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </div>
            <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-full mt-2 max-h-60 overflow-auto">
              {% for choice in form.pet.field.choices %}
                {% if choice.0 %}
                  <li>
                    <a onclick="selectPet('{{ choice.0 }}', '{{ choice.1|escapejs }}')">
                      {{ choice.1 }}
                    </a>
                  </li>
                {% endif %}
              {% endfor %}
            </ul>
          </div>
          <!-- Hidden select for form submission -->
          {% render_field form.pet class="hidden" id="pet-select" %}
          {% if form.pet.errors %}
            <label class="label">
              <span class="label-text-alt text-error">
                {{ form.pet.errors.0 }}
              </span>
            </label>
          {% endif %}
        </div>

        <div class="form-control">
          <label class="label">
            <span class="label-text font-semibold">
              Requested Adoption Date (Optional)
            </span>
          </label>
          {% render_field form.requested_date type="date" class="input input-bordered w-full" %}
          {% if form.requested_date.errors %}
            <label class="label">
              <span class="label-text-alt text-error">
                {{ form.requested_date.errors.0 }}
              </span>
            </label>
          {% endif %}
        </div>

        <div class="form-control">
          <label class="label">
            <span class="label-text font-semibold">
              Why do you want to adopt this pet?
            </span>
          </label>
          {% render_field form.notes rows="4" placeholder="Tell us why you want to adopt this pet..." class="textarea textarea-bordered w-full" %}
          {% if form.notes.errors %}
            <label class="label">
              <span class="label-text-alt text-error">
                {{ form.notes.errors.0 }}
              </span>
            </label>
          {% endif %}
        </div>

        <div class="card-actions justify-end gap-4">
          <a href="{% url 'my_applications' %}" 
             class="btn btn-ghost">
            Cancel
          </a>
          <button type="submit" class="btn btn-primary">
            Submit Application
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  function selectPet(value, text) {
    document.getElementById('selected-pet-text').textContent = text;
    document.getElementById('pet-select').value = value;
    // Close dropdown by removing focus
    document.activeElement.blur();
  }
</script>
{% endblock %}